{
  "patch_id": "round264_patch",
  "previous_patch_id": "round263_patch",
  "round": 264,
  "created_utc": "2026-02-03T13:40:00Z",
  "summary": "Fix test/CI build by factoring spritegen into an SDL-free library, silencing Werror-only unused helpers, and making ecosystem crafting tests run on non-camp levels.",
  "files_changed_or_added_this_round": [
    "PATCH_MANIFEST.json",
    "CMakeLists.txt",
    "tests/CMakeLists.txt",
    "src/dungeon.cpp",
    "src/dungeon.hpp",
    "src/spritegen.cpp",
    "src/spritegen3d.cpp",
    "tests/test_main.cpp"
  ],
  "files_in_patch_zip": [
    "PATCH_MANIFEST.json",
    ".github/workflows/blank.yml",
    "CMakeLists.txt",
    "dungeon.cpp",
    "src/ai.cpp",
    "src/combat.cpp",
    "src/corridor_braid.cpp",
    "src/crafting_gen.hpp",
    "src/dungeon.cpp",
    "src/dungeon.hpp",
    "src/game.cpp",
    "src/game.hpp",
    "src/game_automove.cpp",
    "src/game_interact.cpp",
    "src/game_inventory.cpp",
    "src/game_loop.cpp",
    "src/game_save.cpp",
    "src/game_spawn.cpp",
    "src/game_spellcasting.cpp",
    "src/game_world.cpp",
    "src/overworld.hpp",
    "src/render.cpp",
    "src/scent_field.hpp",
    "src/scores.cpp",
    "src/spritegen.cpp",
    "src/spritegen.hpp",
    "src/spritegen3d.cpp",
    "src/terrain_sculpt.cpp",
    "src/wards.hpp",
    "src/wfc.hpp",
    "tests/CMakeLists.txt",
    "tests/test_main.cpp"
  ],
  "notes_for_reviewer": [
    "CMake: new procrogue_spritegen (SDL-free) library; game and tests now link to it.",
    "Werror: annotate several unused internal helpers with [[maybe_unused]] so tests-only builds succeed.",
    "EcosystemFx: fix FungalBloom/FloodedGrotto scent-decay sign to match intended behavior and unit tests.",
    "Tests: ecosystem catalyst/refinement tests now descend from Camp to Main and choose positions by matching workstation.",
    "Tests: auto-unequip crafting check now asserts the consumed item id is removed (output can legally be same kind)."
  ],
  "patch_notes": [
    "CMake: factor sprite generation sources into a reusable SDL-free library and link it into both the game and unit tests.",
    "Fix -Werror unused-function failures in dungeon and spritegen sources by marking inactive helpers as maybe_unused.",
    "Ecosystem stealth FX: correct scent-decay deltas for FungalBloom and FloodedGrotto.",
    "Tests: make ecosystem crafting tests run on non-camp levels and be robust to room/workstation layout.",
    "Tests: refine the auto-unequip craft assertion to track the consumed item by id."
  ],
  "notes": [
    "Unit tests now link spritegen without enabling SDL/game builds.",
    "CI/test builds with -Werror no longer fail on unused internal helpers.",
    "Ecosystem catalyst tests run from a dungeon level that actually generates ecosystems."
  ]
}
