# Particles / VFX

This project uses a lightweight **procedural particle system** for moment-to-moment VFX.

The particle simulation and rendering lives on the **renderer side** (SDL), but gameplay can request
visuals via a small queue of **visual-only FX events** (`FXParticleEvent`) in `Game`.

## Sources of particles

Particles can be spawned from a few places:

- Renderer-side heuristics:
  - melee hit puffs (HP deltas)
  - projectile trails (`FXProjectile`)
  - explosions (`FXExplosion`)
  - certain environmental tiles (e.g. fire fields)
- Game-driven requests:
  - `Game::pushFxParticle(...)` queues an `FXParticleEvent` which the renderer consumes each frame

## Game-driven particle events

`FXParticleEvent` is a **visual-only** struct (not serialized) that contains:

- a `preset` (what kind of effect to play)
- a tile `pos`
- `intensity` (scales emission rate)
- `delay`, `timer`, `duration` (lifetime / timing)
- a deterministic `seed` (optional; autogenerated if `0`)

### Presets

Current presets (see `FXParticlePreset` in `src/game.hpp`):

- `Heal` – green-ish sparks/embers rising
- `Buff` – warm/golden sparks/embers
- `Invisibility` – purple-ish smoke swirl
- `Blink` – brighter smoke + sparks burst
- `Poison` – green-ish smoke cloud
- `Dig` – dusty brown smoke puff
- `Detect` – cyan sparks (sensing / reveal)

### Adding a new VFX hook in gameplay

Call the helper from gameplay code:

```cpp
pushFxParticle(FXParticlePreset::Dig, Vec2i{x, y}, /*intensity=*/24, /*duration=*/0.14f);
```

The renderer will emit particles for the event while it remains active (`timer < duration`).

## Determinism

The particle system is intentionally **visual-only**:

- It does not affect gameplay simulation.
- `pushFxParticle` does **not** advance the gameplay RNG.
- A deterministic seed is generated from the run seed, turn count, preset, and position if you pass `seed = 0`.

